{"ast":null,"code":"import _regeneratorRuntime from \"/home/asd/Work/Learning/next-frontend/node_modules/@babel/runtime/regenerator\";\nimport _defineProperty from \"/home/asd/Work/Learning/next-frontend/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"/home/asd/Work/Learning/next-frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport Router from \"next/router\";\nvar RETRY_COUNT = 5; // console.log(process.env.BASE_URL);\n\nfunction api(_x, _x2, _x3, _x4) {\n  return _api.apply(this, arguments);\n}\n\nfunction _api() {\n  _api = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(endpoint, method, data, optHeaders) {\n    var BASE_URL, router, token, requestUrl, requestConfig, response, results;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            BASE_URL = process.env.BASE_URL;\n            router = Router;\n\n            if (!(true && window.localStorage)) {\n              _context.next = 6;\n              break;\n            }\n\n            _context.next = 5;\n            return localStorage.getItem(\"token\");\n\n          case 5:\n            token = _context.sent;\n\n          case 6:\n            requestUrl = \"\".concat(BASE_URL).concat(endpoint);\n            console.log(requestUrl);\n            requestConfig = {\n              method: method,\n              // mode: \"cors\",\n              headers: {\n                \"Content-Type\": \"application/json\"\n              },\n              // credentials: \"include\",\n              body: JSON.stringify(data)\n            };\n\n            if (token) {\n              // console.log(\"token: \", token);\n              requestConfig.headers = _objectSpread(_objectSpread({}, requestConfig.headers), {}, {\n                Authorization: token\n              });\n            }\n\n            _context.prev = 10;\n            _context.next = 13;\n            return fetch(requestUrl, requestConfig);\n\n          case 13:\n            response = _context.sent;\n            _context.next = 16;\n            return response.json();\n\n          case 16:\n            results = _context.sent;\n\n            if (!results.error) {\n              _context.next = 23;\n              break;\n            }\n\n            console.log(\"error: \", results.error);\n\n            if (!(results.error.code === \"invalid token\")) {\n              _context.next = 23;\n              break;\n            }\n\n            _context.next = 22;\n            return localStorage.removeItem(\"token\");\n\n          case 22:\n            router.push(\"/login\");\n\n          case 23:\n            return _context.abrupt(\"return\", results);\n\n          case 26:\n            _context.prev = 26;\n            _context.t0 = _context[\"catch\"](10);\n            console.log(_context.t0);\n\n          case 29:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[10, 26]]);\n  }));\n  return _api.apply(this, arguments);\n}\n\nexport default api;","map":{"version":3,"sources":["/home/asd/Work/Learning/next-frontend/apiProvider.js"],"names":["Router","RETRY_COUNT","api","endpoint","method","data","optHeaders","BASE_URL","process","env","router","window","localStorage","getItem","token","requestUrl","console","log","requestConfig","headers","body","JSON","stringify","Authorization","fetch","response","json","results","error","code","removeItem","push"],"mappings":";;;;;;;;AAAA,OAAOA,MAAP,MAAmB,aAAnB;AACA,IAAMC,WAAW,GAAG,CAApB,C,CAEA;;SAEeC,G;;;;;kEAAf,iBAAmBC,QAAnB,EAA6BC,MAA7B,EAAqCC,IAArC,EAA2CC,UAA3C;AAAA;AAAA;AAAA;AAAA;AAAA;AACQC,YAAAA,QADR,GACmBC,OAAO,CAACC,GAAR,CAAYF,QAD/B;AAEQG,YAAAA,MAFR,GAEiBV,MAFjB;;AAAA,kBAKM,QAAiCW,MAAM,CAACC,YAL9C;AAAA;AAAA;AAAA;;AAAA;AAAA,mBAMkBA,YAAY,CAACC,OAAb,CAAqB,OAArB,CANlB;;AAAA;AAMIC,YAAAA,KANJ;;AAAA;AAQQC,YAAAA,UARR,aAQwBR,QARxB,SAQmCJ,QARnC;AAUEa,YAAAA,OAAO,CAACC,GAAR,CAAYF,UAAZ;AACMG,YAAAA,aAXR,GAWwB;AACpBd,cAAAA,MAAM,EAANA,MADoB;AAEpB;AACAe,cAAAA,OAAO,EAAE;AACP,gCAAgB;AADT,eAHW;AAMpB;AACAC,cAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAejB,IAAf;AAPc,aAXxB;;AAqBE,gBAAIS,KAAJ,EAAW;AACT;AACAI,cAAAA,aAAa,CAACC,OAAd,mCAA6BD,aAAa,CAACC,OAA3C;AAAoDI,gBAAAA,aAAa,EAAET;AAAnE;AACD;;AAxBH;AAAA;AAAA,mBA2B2BU,KAAK,CAACT,UAAD,EAAaG,aAAb,CA3BhC;;AAAA;AA2BUO,YAAAA,QA3BV;AAAA;AAAA,mBA4B0BA,QAAQ,CAACC,IAAT,EA5B1B;;AAAA;AA4BUC,YAAAA,OA5BV;;AAAA,iBA8BQA,OAAO,CAACC,KA9BhB;AAAA;AAAA;AAAA;;AA+BMZ,YAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ,EAAuBU,OAAO,CAACC,KAA/B;;AA/BN,kBAgCUD,OAAO,CAACC,KAAR,CAAcC,IAAd,KAAuB,eAhCjC;AAAA;AAAA;AAAA;;AAAA;AAAA,mBAiCcjB,YAAY,CAACkB,UAAb,CAAwB,OAAxB,CAjCd;;AAAA;AAkCQpB,YAAAA,MAAM,CAACqB,IAAP,CAAY,QAAZ;;AAlCR;AAAA,6CAqCWJ,OArCX;;AAAA;AAAA;AAAA;AAuCIX,YAAAA,OAAO,CAACC,GAAR;;AAvCJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;AA2CA,eAAef,GAAf","sourcesContent":["import Router from \"next/router\";\nconst RETRY_COUNT = 5;\n\n// console.log(process.env.BASE_URL);\n\nasync function api(endpoint, method, data, optHeaders) {\n  const BASE_URL = process.env.BASE_URL;\n  const router = Router;\n  let token;\n\n  if (typeof window !== \"undefined\" && window.localStorage)\n    token = await localStorage.getItem(\"token\");\n\n  const requestUrl = `${BASE_URL}${endpoint}`;\n\n  console.log(requestUrl);\n  const requestConfig = {\n    method,\n    // mode: \"cors\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n    // credentials: \"include\",\n    body: JSON.stringify(data),\n  };\n\n  if (token) {\n    // console.log(\"token: \", token);\n    requestConfig.headers = { ...requestConfig.headers, Authorization: token };\n  }\n\n  try {\n    const response = await fetch(requestUrl, requestConfig);\n    const results = await response.json();\n\n    if (results.error) {\n      console.log(\"error: \", results.error);\n      if (results.error.code === \"invalid token\") {\n        await localStorage.removeItem(\"token\");\n        router.push(\"/login\");\n      }\n    }\n    return results;\n  } catch (e) {\n    console.log(e);\n  }\n}\n\nexport default api;\n"]},"metadata":{},"sourceType":"module"}